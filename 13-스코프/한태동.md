# 13장. 스코프

## 스코프란?

식별자가 유효한 범위를 말한다.

```jsx
function add(x, y) {
  // 매개변수는 함수 몸체 내부에서만 참조할 수 있다.
  // 즉, 매개변수의 스코프(유효범위)는 함수 몸체 내부다.
  console.log(x, y); // 2 5
  return x + y;
}

add(2, 5);

// 매개변수는 함수 몸체 내부에서만 참조할 수 있다.
console.log(x, y); // ReferenceError: x is not defined
```

위 코드와 같이 함수의 매개변수는 함수 몸체 내부에서만 참조할 수 있고, 외부에서 참조시 오류가 발생한다. 즉, 변수는 자신이 선언된 위치에 의해 자신이 유효한 범위가 결정된다.

```jsx
var x = "global";

function foo() {
  var x = "local";
  console.log(x); // ①
}

foo();

console.log(x); // ②
```

- 다음 코드에서 두 개의 x 변수 중 어떤 변수를 참조해야 할 것인지를 결정하는 것을 **식별자 결정 이라고 한다.**
- 자바스크립트는 스코프를 통해서 식별자를 결정한다.

## 스코프의 종류

코드는 전역과 지역으로 구분할 수 있다.

### 전역 스코프(Global Scope)

```jsx
let globalVar = "I am a global variable";

function foo() {
  console.log(globalVar); // 전역 변수에 접근 가능
}

foo(); // "I am a global variable" 출력
console.log(globalVar); // "I am a global variable" 출력
```

- 전역이란 코드의 가장 바깥 영역이다.
- 전역은 전역 스코프를 만든다.
- 전역에 변수를 선언하면 전역 스코프를 갖는 전역 변수가 된다.
- 전역 변수는 어디서든지 참조할 수 있다.

### **지역 스코프 (Local Scope)**

**지역 스코프**는 특정 **함수나 블록 내부**에서만 접근할 수 있는 범위를 의미한다. 함수나 블록 내부에 선언된 변수는 해당 함수나 블록 안에서만 참조할 수 있다.

- **지역 변수**는 **함수 또는 블록 내부**에서 선언된 변수이다.
- 함수 또는 블록이 끝나면 해당 지역 변수는 **메모리에서 해제된다.**

```jsx
function foo() {
  let localVar = "I am a local variable";
  console.log(localVar); // "I am a local variable" 출력
}

foo();

console.log(localVar); // ReferenceError: localVar is not defined
```

- 위 예시에서 `localVar`는 함수 `foo` 내부에 선언된 지역 변수이기 때문에, 함수 외부에서는 접근할 수 없다.

## 스코프 체인

자바스크립트는 **스코프 체인**이라는 구조를 통해, **현재 스코프에서 변수를 찾을 수 없을 때**는 **상위 스코프를 거슬러 올라가면서 변수를 찾는 방식**을 사용한다. 즉, 지역 스코프에서 찾지 못한 변수는 그 상위인 전역 스코프에서 찾게 된다.

```jsx
let globalVar = "I am global";

function outer() {
  let outerVar = "I am in outer scope";

  function inner() {
    let innerVar = "I am in inner scope";
    console.log(globalVar); // 전역 변수 접근 가능
    console.log(outerVar); // 외부 함수의 지역 변수 접근 가능
    console.log(innerVar); // 내부 함수의 지역 변수 접근 가능
  }

  inner();
}

outer();
```

- `inner` 함수는 **스코프 체인**을 따라 `outerVar`와 `globalVar`에도 접근할 수 있습니다. 반면, `outer` 함수와 전역에서는 `innerVar`에 접근할 수 없습니다.

### 함수 레벨 스코프(Function-level Scope)

- **함수 레벨 스코프**는 **함수 내부에서 선언된 변수**만 해당 함수 내에서만 유효한 범위를 가지는 스코프 규칙이다.
- 자바스크립트에서는 `var` 키워드로 선언된 변수는 **블록 레벨**이 아니라 **함수 레벨** 스코프를 따른다. 이는 함수 내에서 선언된 `var` 변수가 **함수 전체에서** 유효하다는 의미이다.

```jsx
if (true) {
  var x = 10; // 함수 레벨 스코프
}
console.log(x); // 10 (if 블록을 벗어나도 접근 가능)
```

- 위 예제에서 `var`로 선언된 변수 `x`는 `if` 블록 내에서 선언되었지만, **블록 밖에서도 접근 가능하**다. 이는 `var`가 **블록 레벨 스코프**를 따르지 않고, **함수 전체**에 걸쳐 유효하기 때문이다.

### 특징:

- 함수 내에서만 스코프가 적용되므로, **블록({}) 내에서 선언된 변수라도 함수 전체에서 접근 가능**.
- 함수 바깥에서는 해당 변수에 접근할 수 없다.

---

### 렉시컬 스코프(Lexical Scope)

- **렉시컬 스코프**는 **함수가 어디서 정의되었는지**에 따라 상위 스코프가 결정되는 스코프 규칙이다. 즉, **함수가 정의된 시점의 스코프**가 함수 호출 시에도 유지된다.
- 자바스크립트는 **렉시컬 스코프**를 따르므로, 함수는 **자신이 정의된 환경**(상위 스코프)에 대한 참조를 유지하고, **호출 위치**가 아니라 **정의된 위치**에서의 스코프 규칙을 따른다.

```jsx
const x = 1;

function outer() {
  const x = 10;

  function inner() {
    console.log(x); // 10 (inner 함수가 정의된 outer 스코프의 x를 참조)
  }

  inner();
}

outer();
```

- `inner` 함수는 `outer` 함수 내부에서 정의되었기 때문에, **외부 스코프인 `outer`의 변수 `x`\*를 참조합니다. 호출 위치에 관계없이 **함수가 정의된 환경\*\*을 기준으로 스코프가 결정됩니다.

### 특징:

- **함수의 호출 위치와 관계없이**, 함수가 **정의된 위치**에 따라 상위 스코프가 결정됨.
- 자바스크립트는 **렉시컬 스코프**를 따르는 언어입니다.

---

### 요약

| **개념**             | **설명**                                                                                                                 | **특징**                                                                                                 |
| -------------------- | ------------------------------------------------------------------------------------------------------------------------ | -------------------------------------------------------------------------------------------------------- |
| **함수 레벨 스코프** | `var`로 선언된 변수는 **블록이 아닌 함수 단위**로 스코프가 설정되며, 블록 내에서도 함수 전체에서 접근 가능.              | `var` 키워드는 **블록 스코프를 무시**하고 **함수 내**에서만 스코프가 적용됨.                             |
| **렉시컬 스코프**    | 함수가 **어디서 정의되었는지**에 따라 상위 스코프가 결정되며, 호출 위치와 상관없이 정의된 환경을 기준으로 스코프가 작동. | 함수는 **정의된 위치**에서 상위 스코프를 찾으며, 호출된 위치에 상관없이 **정의 당시의 스코프**를 참조함. |
