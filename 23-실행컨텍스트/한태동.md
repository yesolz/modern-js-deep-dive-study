# 23장. 실행 컨텍스트

날짜: 2024년 10월 4일

**실행 컨텍스트(Execution Context)**는 자바스크립트의 동작 원리를 담고 있는 핵심 개념으로, 코드가 실행되는 환경을 정의하고 관리하는 역할을 한다. 이를 통해 자바스크립트 엔진은 변수, 함수, 스코프 등을 관리하며 코드의 실행 순서를 제어한다.

### 1. **소스코드 타입**

ECMAScript 사양은 소스코드를 다음 4가지 타입으로 구분한다:

- **전역 코드**: 전역에 존재하는 코드.
- **함수 코드**: 함수 내부에 존재하는 코드.
- **eval 코드**: `eval` 함수로 실행되는 코드.
- **모듈 코드**: 모듈 시스템에서 관리되는 코드.

### 2. **소스코드의 평가와 실행**

- **평가 단계**: 실행 컨텍스트가 생성되며, 변수와 함수 선언만 먼저 실행되어 스코프에 등록된다.
- **실행 단계**: 평가가 끝난 후 런타임에서 코드가 순차적으로 실행되며, 선언문을 제외한 나머지 코드가 실행된. 이때 필요한 정보(변수, 함수)는 실행 컨텍스트 내에서 관리되는 스코프에서 검색된다.

### 3. **실행 컨텍스트의 역할**

실행 컨텍스트는 코드 실행에 필요한 환경을 제공하고, 다음과 같은 주요 기능을 수행합니다:

- **식별자와 스코프 관리**: 변수, 함수 등 식별자를 스코프에 등록하고 관리한다.
- **스코프 체인 관리**: 스코프 간의 중첩 관계를 통해 상위 스코프까지 식별자를 검색할 수 있도록 관리한다.
- **코드 실행 순서 제어**: 함수 호출 시 실행 순서를 일시 중단하고, 실행이 끝나면 다시 이전 순서로 돌아갈 수 있게 관리한다.

### 4. **실행 컨텍스트 스택**

실행 컨텍스트는 **스택 자료구조**로 관리됩니다. 가장 최근에 실행된 컨텍스트가 스택의 최상위에 위치하며, 실행 중인 코드가 종료되면 스택에서 제거된다.

예시 코드:

```jsx
const x = 1;
function foo() {
  const y = 2;
  function bar() {
    const z = 3;
    console.log(x + y + z); // 6
  }
  bar();
}
foo();
```

1. 전역 코드가 평가 및 실행되며 전역 실행 컨텍스트가 스택에 추가된다.
2. `foo` 함수가 호출되면 `foo` 실행 컨텍스트가 스택에 추가된다.
3. `bar` 함수가 호출되면 `bar` 실행 컨텍스트가 스택에 추가된다.
4. `bar` 함수 실행이 끝나면 스택에서 제거되고, 다시 `foo` 함수로 돌아간다.
5. `foo` 함수가 종료되면 다시 전역 실행 컨텍스트로 돌아간다.

### 5. **렉시컬 환경(Lexical Environment)**

렉시컬 환경은 **식별자와 그에 바인딩된 값**을 관리하는 자료구조로, 실행 컨텍스트의 핵심 컴포넌트이다. 두 가지 주요 구성 요소로 나뉜다:

- **`환경 레코드 (Environment Record)`**: 식별자를 등록하고 그 값을 관리하는 역할.
- **`외부 렉시컬 환경 참조 (Outer Lexical Environment Reference)`**: 상위 스코프에 대한 참조를 유지하여 스코프 체인을 형성.

### 6. **실행 컨텍스트 생성 과정과 식별자 검색**

실행 컨텍스트는 다음과 같은 순서로 생성되고 관리된다.

1. **전역 객체 생성**: 전역 객체는 전역 코드가 실행되기 전에 생성된다.
2. **전역 코드 평가**: 전역 코드가 평가되어 전역 실행 컨텍스트가 생성되고, 전역 렉시컬 환경이 만들어진다.
3. **함수 호출**: 함수가 호출되면 새로운 함수 실행 컨텍스트가 생성되고, 해당 함수의 렉시컬 환경이 스코프 체인을 통해 관리된다.
4. **식별자 검색**: 함수 내부에서 식별자를 참조할 때는 현재 실행 중인 실행 컨텍스트의 렉시컬 환경에서 먼저 찾고, 상위 스코프로 이동해 검색한다.

### 7. **실행 컨텍스트와 블록 레벨 스코프**

- **var**로 선언된 변수는 함수 레벨 스코프를 따르며, 함수 내에서만 스코프가 형성된다.
- **let**, **const**로 선언된 변수는 블록 레벨 스코프를 따르며, 모든 코드 블록 내에서 유효하다.

```jsx
let x = 1;
if (true) {
  let x = 10;
  console.log(x); // 10 (블록 내의 x)
}
console.log(x); // 1 (전역 x)
```

- `if` 문이 실행되면 새로운 블록 레벨 스코프가 생성되어 이전 스코프를 대체하고, `if` 문이 종료되면 다시 원래 스코프로 돌아간다.
