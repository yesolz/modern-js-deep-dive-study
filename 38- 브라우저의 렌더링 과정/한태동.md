# 38장: 브라우저의 렌더링 과정

브라우저의 렌더링 과정은 HTML, CSS, 자바스크립트 등의 리소스를 파싱하고 이를 브라우저에 시각적으로 출력하는 과정을 의미한다. 이 과정은 여러 단계를 거치며, 웹 페이지의 성능과 사용자 경험에 중요한 영향을 미친다. 각각의 단계는 다음과 같다.

---

## 1. 요청과 응답

### 요청(Request)

- 사용자가 브라우저의 주소창에 URL을 입력하고 엔터를 누르면, 브라우저는 DNS(Domain Name System)을 통해 해당 URL의 호스트 이름을 IP 주소로 변환한다. 이후 이 IP 주소를 사용하여 서버에 리소스를 요청하게 된다.

### 응답(Response)

- 서버는 브라우저가 요청한 리소스를 응답한다. 이 리소스는 HTML, CSS, 자바스크립트, 이미지, 폰트 파일 등으로 이루어져 있으며, 브라우저는 이를 파싱해 웹 페이지를 렌더링한다.

---

## 2. HTTP 1.1과 HTTP 2.0

### HTTP(HyperText Transfer Protocol)

- HTTP는 브라우저와 서버가 웹에서 통신하기 위한 프로토콜이다.

### HTTP 1.1

- HTTP 1.1은 한 번에 하나의 요청과 응답만 처리할 수 있다. 여러 리소스를 요청할 때 각 요청이 순차적으로 이루어지며, 이에 따라 웹 페이지 로딩 속도가 느려질 수 있다.

### HTTP 2.0

- HTTP 2.0은 하나의 커넥션에서 여러 요청과 응답을 동시에 처리할 수 있다. 이로 인해 여러 리소스를 한 번에 전송할 수 있으며, 페이지 로드 속도가 HTTP 1.1에 비해 약 50% 빠르다.

---

## 3. HTML 파싱과 DOM 생성

### HTML 파싱

- 브라우저는 서버로부터 응답받은 HTML 문서를 텍스트 문자열로 받아온다. 이 문자열을 브라우저가 이해할 수 있는 구조로 변환하기 위해 HTML 문서를 파싱하게 된다.

### DOM(Document Object Model) 생성

- 파싱 과정에서 브라우저는 HTML 문서를 토큰으로 분해하고, 이를 객체로 변환하여 DOM을 생성한다. DOM은 HTML 문서의 구조와 내용을 트리 구조로 나타낸 객체 모델이며, 브라우저는 이를 메모리에 저장하여 렌더링에 사용한다.

---

## 4. CSS 파싱과 CSSOM 생성

### CSS 파싱

- HTML 파싱 도중 브라우저는 `<link>` 또는 `<style>` 태그를 만나면 CSS 파일을 로드하고 파싱하게 된다. 이 과정에서 브라우저는 CSS를 토큰으로 분해하고, 이를 객체로 변환하여 CSSOM을 생성한다.

### CSSOM 생성

- CSSOM은 CSS 파일의 상속 규칙 등을 반영하여 생성된 트리 구조로, DOM과 결합되어 렌더링 과정에서 사용된다.

---

## 5. 렌더 트리 생성

### 렌더 트리(Render Tree)

- 브라우저는 DOM과 CSSOM을 결합하여 렌더 트리를 생성한다. 렌더 트리는 실제 화면에 렌더링될 요소들만 포함한 트리 구조로, 예를 들어 `display: none`으로 설정된 요소들은 렌더 트리에 포함되지 않는다.

### 레이아웃(Layout)

- 렌더 트리가 생성된 후, 브라우저는 각 요소의 위치와 크기를 계산하는 레이아웃 과정을 진행한다. 이를 통해 페이지에서 각 요소가 차지할 공간이 결정된다.

### 페인팅(Painting)

- 렌더 트리를 기반으로 브라우저는 각 요소를 화면에 그리는 페인팅 과정을 진행하며, 최종적으로 사용자가 볼 수 있는 화면이 완성된다.

---

## 6. 자바스크립트 파싱과 실행

### 자바스크립트 파싱

- 브라우저는 HTML 파싱 중 `<script>` 태그를 만나면 자바스크립트 파일을 로드하고 실행하게 된다. 자바스크립트는 브라우저의 자바스크립트 엔진에 의해 파싱된다.

### AST(Abstract Syntax Tree) 생성

- 자바스크립트 엔진은 자바스크립트 코드를 파싱해 AST(추상 구문 트리)를 생성한다. AST는 자바스크립트 코드의 구조를 나타내는 트리 형태의 자료구조이다.

### 바이트코드로 변환 및 실행

- 생성된 AST는 바이트코드로 변환된 후 브라우저의 인터프리터에 의해 실행된다. 바이트코드는 브라우저가 실행할 수 있는 중간 코드이다.

---

## 7. 리플로우와 리페인트

### 리플로우(Reflow)

- DOM이나 CSSOM이 변경되면, 브라우저는 레이아웃을 다시 계산하는 리플로우 과정을 거친다. 예를 들어, 자바스크립트로 DOM에 새로운 요소를 추가하거나 크기나 위치를 변경하면 리플로우가 발생한다.

### 리페인트(Repaint)

- 리플로우 후에는 브라우저가 변경된 내용을 화면에 다시 그리는 리페인트 과정이 진행된다. 리플로우가 필요하지 않은 경우, 색상 변경 등 스타일 변화만 있을 때는 리페인트만 발생한다.

---

## 8. 자바스크립트 파싱에 의한 HTML 파싱 중단

### HTML 파싱 중단

- 자바스크립트는 HTML 파싱 중간에 실행되기 때문에 DOM이 완성되기 전에 자바스크립트가 DOM을 조작하려 하면 오류가 발생할 수 있다. 이를 방지하기 위해 자바스크립트 코드를 HTML 문서의 하단에 배치하거나, `async`나 `defer` 어트리뷰트를 사용해 비동기적으로 실행하게 한다.

---

## 9. `async`와 `defer` 어트리뷰트

### async

- `async` 어트리뷰트는 자바스크립트 파일의 로드와 HTML 파싱을 동시에 진행하지만, 자바스크립트는 파일이 로드된 직후 실행된다. 이때 HTML 파싱이 중단되며, 여러 자바스크립트 파일이 있으면 순서와 상관없이 로드된 순서대로 실행된다.

### defer

- `defer` 어트리뷰트는 HTML 파싱과 자바스크립트 파일 로드를 비동기적으로 진행하지만, 자바스크립트는 HTML 파싱이 완료된 후 실행된다. DOM 생성이 완료된 이후 자바스크립트를 실행해야 할 때 유용하다.

---

이 과정은 브라우저가 웹 페이지를 로드하고 사용자에게 보여주기까지의 주요 단계를 설명한 것이며, 각 단계는 웹 성능에 중요한 영향을 미친다.
